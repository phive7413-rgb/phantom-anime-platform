<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>phantomHIVE â€” Anime</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#04040a; --panel:#070712; --neon1:#00e6ff; --neon2:#9b59ff; --muted:rgba(255,255,255,0.7);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto; background: linear-gradient(180deg,var(--bg),#070712); color:#eaf6ff;}
    header{padding:16px 22px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(255,255,255,0.02)}
    .logo{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,var(--neon2),var(--neon1));display:flex;align-items:center;justify-content:center;font-weight:700;color:#02040a}
    main{max-width:1100px;margin:24px auto;padding:0 20px}
    .hero{display:flex;gap:22px;align-items:center;flex-wrap:wrap}
    .hero .cover{width:180px;height:180px;border-radius:12px;overflow:hidden;flex:0 0 180px}
    .hero .cover img{width:100%;height:100%;object-fit:cover}
    .hero .meta h1{margin:0;color:var(--neon2);font-size:28px}
    .meta p{color:var(--muted);margin-top:6px}

    .controls{display:flex;gap:12px;margin-top:18px;align-items:center;flex-wrap:wrap}
    .controls input[type="search"]{padding:12px;border-radius:10px;border:0;background:rgba(255,255,255,0.02);color:inherit;min-width:240px}
    .controls select{padding:12px;border-radius:10px;border:0;background:rgba(255,255,255,0.02);color:inherit}
    .controls .count{color:var(--muted);font-size:14px;margin-left:8px}

    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;margin-top:24px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:14px;border-radius:12px;border:1px solid rgba(155,89,255,0.06);transition:transform .18s;overflow:hidden}
    .card:hover{transform:translateY(-8px)}
    .card img{width:100%;height:220px;object-fit:cover;border-radius:8px}
    .card h3{margin:10px 0 4px;color:var(--neon1)}
    .meta small{color:var(--muted);display:block;margin-top:6px}

    .tag{display:inline-block;padding:6px 10px;border-radius:999px;font-size:12px;margin-right:8px;background:rgba(155,89,255,0.08);color:var(--neon2)}
    .no-results{color:#ff9b9b;margin-top:18px}

    @media (max-width:640px){
      .hero{flex-direction:column;align-items:flex-start}
      .hero .cover{width:100%;height:220px}
    }
  </style>
</head>
<body>
  <header>
    <div style="display:flex;gap:14px;align-items:center">
      <div class="logo">ph</div>
      <div>
        <div style="font-weight:700;color:var(--neon1)">phantomHIVE</div>
        <div style="font-size:13px;color:rgba(255,255,255,0.6)">Anime character directory</div>
      </div>
    </div>
    <div>
      <a href="index.html" style="color:var(--neon1);text-decoration:none;margin-right:12px">Home</a>
      <a href="contact.html" style="color:rgba(255,255,255,0.7);text-decoration:none">Contact</a>
    </div>
  </header>

  <main>
    <section class="hero" id="hero">
      <!-- injected -->
    </section>

    <div class="controls">
      <input id="searchInput" type="search" placeholder="Search characters by name (eg: Naruto, Luffy)" />
      <select id="categorySelect">
        <option value="">All categories</option>
      </select>
      <div class="count" id="count"></div>
    </div>

    <div id="grid" class="grid" aria-live="polite"></div>
    <div id="noResults" class="no-results" style="display:none">No characters found.</div>
  </main>

  <script>
    // Utility: read query params
    function qp(name){ const url=new URL(location); return url.searchParams.get(name); }

    async function loadAnime(){
      try{
        const res = await fetch('data/anime.json'); const data = await res.json();
        const slug = qp('anime') || qp('search') || '';
        let animeEntry;
        if(qp('anime')){
          animeEntry = data.anime.find(x => x.slug === qp('anime'));
        } else if (qp('search')){
          // show first anime that has a matching character name
          const q = qp('search').toLowerCase();
          animeEntry = data.anime.find(a => a.characters.some(c => c.name.toLowerCase().includes(q)));
        } else {
          // default to first
          animeEntry = data.anime[0];
        }

        if(!animeEntry){
          document.getElementById('hero').innerHTML = '<div style="color:#ff9b9b">Anime not found. Go back to <a href="index.html">home</a>.</div>';
          return;
        }

        renderHero(animeEntry);
        initControls(animeEntry);
        renderCharacters(animeEntry.characters || []);
      }catch(e){
        document.getElementById('hero').innerHTML = '<div style="color:#ff9b9b">Failed to load data/anime.json</div>';
        console.error(e);
      }
    }

    function renderHero(anime){
      const hero = document.getElementById('hero');
      hero.innerHTML = `
        <div class="cover"><img src="${anime.cover || 'assets/img/placeholder-anime.jpg'}" alt="${anime.name}"></div>
        <div class="meta">
          <h1>${anime.name}</h1>
          <p>${anime.description || ''}</p>
          <div style="margin-top:10px">${(anime.tags || []).map(t => `<span class="tag">${t}</span>`).join('')}</div>
        </div>
      `;
    }

    function initControls(anime){
      const catSelect = document.getElementById('categorySelect');
      const cats = Array.from(new Set((anime.characters||[]).flatMap(c => c.categories || [])));
      catSelect.innerHTML = '<option value="">All categories</option>' + cats.map(c => `<option value="${c}">${c}</option>`).join('');
      document.getElementById('searchInput').value = qp('search') || '';
      document.getElementById('searchInput').addEventListener('input', () => applyFilters(anime));
      catSelect.addEventListener('change', () => applyFilters(anime));
    }

    function renderCharacters(list){
      const grid = document.getElementById('grid');
      grid.innerHTML = '';
      list.forEach(c => {
        const card = document.createElement('div'); card.className = 'card';
        card.innerHTML = `
          <img src="${c.image || 'assets/img/placeholder-character.jpg'}" alt="${c.name}">
          <h3>${c.name}</h3>
          <small>${c.role || ''}</small>
          <div style="margin-top:8px">${(c.categories||[]).map(t=>`<span class="tag">${t}</span>`).join('')}</div>
        `;
        grid.appendChild(card);
      });
      document.getElementById('count').textContent = `${list.length} character${list.length===1?'':'s'}`;
      document.getElementById('noResults').style.display = list.length ? 'none' : '';
    }

    function applyFilters(anime){
      const q = document.getElementById('searchInput').value.trim().toLowerCase();
      const cat = document.getElementById('categorySelect').value;
      let filtered = (anime.characters || []).filter(c => {
        const matchQ = !q || c.name.toLowerCase().includes(q) || (c.description || '').toLowerCase().includes(q);
        const matchCat = !cat || (c.categories || []).includes(cat);
        return matchQ && matchCat;
      });
      renderCharacters(filtered);
    }

    loadAnime();
  </script>
</body>
    </html>
